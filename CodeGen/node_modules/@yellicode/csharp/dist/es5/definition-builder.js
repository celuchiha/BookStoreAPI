import * as elements from '@yellicode/elements';
import * as opts from './options';
import { ParameterDirectionKind } from '@yellicode/elements';
import { CSharpTypeNameProvider } from './csharp-type-name-provider';
var DefinitionBuilder = /** @class */ (function () {
    function DefinitionBuilder(typeNameProvider) {
        this.typeNameProvider = typeNameProvider;
    }
    DefinitionBuilder.prototype.buildNamespaceDefinition = function (pack, options) {
        if (!options)
            options = {};
        // We have no namespace features yet, but the NamespaceFeatures type is there for future extension
        var features = (options.features === undefined) ? opts.NamespaceFeatures.All : options.features;
        var name;
        if (options.writeFullName) {
            var allPackages = pack.getNestingPackages();
            allPackages.push(pack); // add the package itself
            name = allPackages.map(function (p) { return p.name; }).join('.');
        }
        else
            name = pack.name;
        return { name: name };
    };
    DefinitionBuilder.prototype.buildClassDefinition = function (type, options) {
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.ClassFeatures.All : options.features;
        // Build the base definition
        var definition = DefinitionBuilder.buildTypeDefinition(type, !!(features & opts.ClassFeatures.XmlDocSummary), options);
        // Build the class-specific definition
        definition.inherits = DefinitionBuilder.buildInherits(type, options.inherits);
        definition.implements = DefinitionBuilder.buildImplements(type, options.implements);
        if (elements.isClass(type)) {
            definition.isAbstract = type.isAbstract || options.isAbstract;
        }
        return definition;
    };
    DefinitionBuilder.prototype.buildStructDefinition = function (type, options) {
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.StructFeatures.All : options.features;
        // Build the base definition
        var definition = DefinitionBuilder.buildTypeDefinition(type, !!(features & opts.StructFeatures.XmlDocSummary), options);
        // Build the struct-specific definition        
        definition.implements = DefinitionBuilder.buildImplements(type, options.implements);
        return definition;
    };
    DefinitionBuilder.prototype.buildInterfaceDefinition = function (type, options) {
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.InterfaceFeatures.All : options.features;
        // Build the base definition
        var definition = DefinitionBuilder.buildTypeDefinition(type, !!(features & opts.InterfaceFeatures.XmlDocSummary), options);
        // Build the interface-specific definition
        definition.inherits = DefinitionBuilder.buildInherits(type, options.inherits);
        return definition;
    };
    DefinitionBuilder.prototype.buildEnumMemberDefinition = function (literal, isLast, options) {
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.EnumMemberFeatures.All : options.features;
        var buildInitializers = !!(features & opts.EnumFeatures.Initializers);
        // Build the base definition
        var definition = DefinitionBuilder.buildDefinitionBase(literal, !!(features & opts.EnumMemberFeatures.XmlDocSummary));
        // Build the member-specific definition
        definition.isLast = isLast || false;
        if (buildInitializers && literal.specification != null) { // using '!=' on purpose  
            var specification = literal.specification;
            definition.value = elements.isLiteralInteger(specification) ? specification.value : undefined;
        }
        return definition;
    };
    DefinitionBuilder.prototype.buildEnumDefinition = function (type, options) {
        var _this = this;
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.EnumFeatures.All : options.features;
        // Build the base definition         
        var definition = DefinitionBuilder.buildDefinitionBase(type, !!(features & opts.EnumFeatures.XmlDocSummary));
        // Build the enum-specific definition
        definition.accessModifier = DefinitionBuilder.getAccessModifierString(type.visibility);
        // Build enum members
        if (elements.isEnumeration(type) && type.ownedLiterals) {
            var members_1 = [];
            // Pass on enum features to enum member features
            var memberFeatures_1 = opts.EnumMemberFeatures.None;
            if (features & opts.EnumFeatures.XmlDocSummary)
                memberFeatures_1 |= opts.EnumMemberFeatures.XmlDocSummary;
            if (features & opts.EnumFeatures.Initializers)
                memberFeatures_1 |= opts.EnumMemberFeatures.Initializers;
            type.ownedLiterals.forEach(function (literal, index) {
                var isLast = index === type.ownedLiterals.length - 1;
                var member = _this.buildEnumMemberDefinition(literal, isLast, { features: memberFeatures_1 });
                members_1.push(member);
            });
            definition.members = members_1;
        }
        return definition;
    };
    DefinitionBuilder.prototype.buildPropertyDefinition = function (property, options) {
        // Initialize options and features
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.PropertyFeatures.All : options.features;
        var ownerIsInterface = elements.isInterface(property.owner);
        // Build the base definition         
        var definition = DefinitionBuilder.buildDefinitionBase(property, !!(features & opts.PropertyFeatures.XmlDocSummary));
        // Build the property-specific definition
        var typename = this.getFullTypeName(property, options.collectionType || null, 'object');
        definition.accessModifier = DefinitionBuilder.getAccessModifierString(property.visibility);
        definition.isVirtual = options.virtual;
        definition.typeName = typename;
        if (!ownerIsInterface && (features & opts.PropertyFeatures.AccessModifier))
            definition.accessModifier = DefinitionBuilder.getAccessModifierString(property.visibility);
        if ((features & opts.PropertyFeatures.OptionalModifier) &&
            property.lower === 0 &&
            CSharpTypeNameProvider.canBeNullable(property, typename)) {
            definition.isNullable = true;
        }
        definition.noSetter = property.isReadOnly || property.isDerived;
        definition.defaultValue = DefinitionBuilder.getDefaultValueString(property.defaultValue);
        return definition;
    };
    DefinitionBuilder.prototype.buildMethodDefinition = function (operation, options) {
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.MethodFeatures.All : options.features;
        var ownerIsInterface = elements.isInterface(operation.owner);
        // Build the base definition         
        var definition = DefinitionBuilder.buildDefinitionBase(operation, !!(features & opts.MethodFeatures.XmlDocSummary));
        definition.isConstructor = operation.isConstructor;
        definition.isStatic = operation.isStatic;
        definition.isPartial = options.isPartial;
        if (!operation.isConstructor) {
            definition.isAbstract = options.isAbstract || (!options.isVirtual && operation.isAbstract);
            definition.isVirtual = options.isVirtual;
        }
        if (!ownerIsInterface)
            definition.accessModifier = DefinitionBuilder.getAccessModifierString(operation.visibility);
        // Get the return type and documentation
        if (!operation.isConstructor) {
            var returnParameter = operation.getReturnParameter();
            if (returnParameter) {
                definition.returnTypeName = this.getFullTypeName(returnParameter, options.collectionType || null);
                if (features & opts.MethodFeatures.XmlDocReturns) {
                    definition.xmlDocReturns = DefinitionBuilder.buildXmlDocSummary(operation);
                }
            }
        }
        // Build parameter definitions      
        definition.parameters = this.buildParameterDefinitions(operation.ownedParameters, options);
        return definition;
    };
    DefinitionBuilder.prototype.buildParameterDefinitions = function (params, options) {
        var _this = this;
        if (!options)
            options = {};
        var features = (options.features === undefined) ? opts.MethodFeatures.All : options.features;
        var inOutParameters = [];
        if (!params)
            return inOutParameters;
        params.forEach(function (p) {
            if (p.direction === ParameterDirectionKind.return)
                return;
            var typeName = _this.getFullTypeName(p, options.collectionType || null, 'object');
            var paramDefinition = DefinitionBuilder.buildDefinitionBase(p, !!(features & opts.MethodFeatures.XmlDocParameters));
            paramDefinition.isOutput = p.direction === elements.ParameterDirectionKind.out;
            paramDefinition.isReference = p.direction === elements.ParameterDirectionKind.inout;
            paramDefinition.isNullable = p.lower === 0 && CSharpTypeNameProvider.canBeNullable(p, typeName);
            paramDefinition.typeName = typeName;
            paramDefinition.defaultValue = DefinitionBuilder.getDefaultValueString(p.defaultValue),
                inOutParameters.push(paramDefinition);
        });
        return inOutParameters;
    };
    DefinitionBuilder.buildInherits = function (type, additional) {
        if (!elements.isClassifier(type)) {
            return;
        }
        var allNames = [];
        if (type.generalizations) {
            // todo: allow qualifiedName
            allNames.push.apply(allNames, type.generalizations.map(function (g) { return g.general.name; }));
        }
        if (additional) {
            allNames.push.apply(allNames, additional);
        }
        return allNames.length ? allNames : undefined;
    };
    DefinitionBuilder.buildImplements = function (type, additional) {
        if (!elements.isBehavioredClassifier(type)) {
            return;
        }
        var allNames = [];
        if (type.interfaceRealizations) {
            // todo: allow qualifiedName 
            allNames.push.apply(allNames, type.interfaceRealizations.map(function (ir) { return ir.contract.name; }));
        }
        if (additional) {
            allNames.push.apply(allNames, additional);
        }
        return allNames.length ? allNames : undefined;
    };
    DefinitionBuilder.buildXmlDocSummary = function (element) {
        if (!element.ownedComments || !element.ownedComments.length) {
            return undefined;
        }
        return element.ownedComments.map(function (c) { return c.body; });
    };
    DefinitionBuilder.buildTypeDefinition = function (type, buildXmlDocSummary, options) {
        var definition = DefinitionBuilder.buildDefinitionBase(type, buildXmlDocSummary);
        definition.accessModifier = DefinitionBuilder.getAccessModifierString(type.visibility);
        definition.isPartial = options.isPartial;
        return definition;
    };
    DefinitionBuilder.buildDefinitionBase = function (element, buildXmlDocSummary) {
        var definition = {
            name: element.name,
            xmlDocSummary: buildXmlDocSummary ? DefinitionBuilder.buildXmlDocSummary(element) : undefined
        };
        return definition;
    };
    DefinitionBuilder.getDefaultValueString = function (defaultValue) {
        if (!defaultValue)
            return undefined;
        return elements.isLiteralString(defaultValue) ?
            "\"" + defaultValue.value + "\"" :
            defaultValue.getStringValue();
    };
    DefinitionBuilder.getAccessModifierString = function (visibility) {
        switch (visibility) {
            case elements.VisibilityKind.public:
                return 'public';
            case elements.VisibilityKind.private:
                return 'private';
            case elements.VisibilityKind.protected:
                return 'protected';
            case elements.VisibilityKind.package:
                return 'internal';
            default:
                return undefined;
        }
    };
    DefinitionBuilder.prototype.getFullTypeName = function (typedElement, collectionType, fallback) {
        var typeName = this.typeNameProvider.getTypeName(typedElement) || fallback;
        if (!typeName)
            return; // no type name and no fallback
        if (elements.isMultiplicityElement(typedElement) && typedElement.isMultivalued()) {
            switch (collectionType) {
                case opts.CollectionType.IList:
                    return "IList<" + typeName + ">";
                case opts.CollectionType.IEnumerable:
                    return "IEnumerable<" + typeName + ">";
                default:
                    return "ICollection<" + typeName + ">";
            }
        }
        else
            return typeName;
    };
    return DefinitionBuilder;
}());
export { DefinitionBuilder };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmaW5pdGlvbi1idWlsZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RlZmluaXRpb24tYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssUUFBUSxNQUFNLHFCQUFxQixDQUFDO0FBQ2hELE9BQU8sS0FBSyxJQUFJLE1BQU0sV0FBVyxDQUFDO0FBRWxDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzdELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRXJFO0lBQ0ksMkJBQW9CLGdCQUEyQztRQUEzQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQTJCO0lBQUksQ0FBQztJQUU3RCxvREFBd0IsR0FBL0IsVUFBZ0MsSUFBc0IsRUFBRSxPQUErQjtRQUNuRixJQUFJLENBQUMsT0FBTztZQUFFLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDM0Isa0dBQWtHO1FBQ2xHLElBQU0sUUFBUSxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztRQUNsRyxJQUFJLElBQVksQ0FBQztRQUNqQixJQUFJLE9BQU8sQ0FBQyxhQUFhLEVBQUU7WUFDdkIsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDOUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLHlCQUF5QjtZQUNqRCxJQUFJLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ2pEOztZQUNJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxD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